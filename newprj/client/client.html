<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Cliente</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" media="screen" href="style.css" />
  </head>
  <body>
    <div class="client-menu">
      <div class="orderBtn">
        <input type="text" placeholder="Ваш телефон" id="phone" />
        <input type="text" placeholder="откуда" id="startPosition" />
        <input type="text" placeholder="куда" id="endPosition" />
        <input type="button" value="Отправить заказ" onClick="makeOrder()" />
      </div>

      <div class="checkMyOrder" id="checkMyOrder">
        <input
          type="button"
          value="Узнать статус моего заказа"
          onClick="getMyStatus()"
        />
      </div>
    </div>
  </body>
</html>
<script>
  function makeOrder() {
    let phoneUser = document.getElementById("phone").value;
    let startPosition = document.getElementById("startPosition").value;
    let endPosition = document.getElementById("endPosition").value;
    let arriveTime = 5;

    var xhr = new XMLHttpRequest();
    xhr.open("POST", "http://localhost:8080/post/order", true);
    xhr.setRequestHeader("Content-Type", "application/json");
    var data = JSON.stringify({
      phoneUser: phoneUser,
      startPosition: startPosition,
      endPosition: endPosition,
      arriveTime: Number(arriveTime)
    });
    console.log(data);
    xhr.send(data);
  }

  function getMyStatus() {
    let xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
      if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
        //json
        checkMyStatus(xmlhttp.responseText);
      }
    };
    xmlhttp.open("GET", "http://localhost:8080/get/checkMyStatus", true);
    xmlhttp.send();
  }

  function checkMyStatus(response) {
    //  опять же у меня нет куки, поэтому все буду делать для 1 себя. id = 123
    let myId = document.getElementById("phone").value;
    let myStatus = -1;
    let arr = JSON.parse(response);
    for (i = 0; i < arr.length; i++) {
      if (myId == arr[i].idOrder) {
        // тут idOrder это и есть номер юзера, стоит поменять
        myStatus = arr[i].status;
      }
    }
    alert(myStatus);

    if (myStatus == 0) {
      let sel = document.getElementById("checkMyOrder");

      let answer = document.createElement("p");
      answer.innerHTML = "Ваш заказ приняли!";

      sel.appendChild(answer);
    }

    if (myStatus == 1) {
      let sel = document.getElementById("checkMyOrder");

      let answer = document.createElement("p");
      answer.innerHTML = "Вы в пути";

      sel.appendChild(answer);
    }
  }

  //могу получить все из таблицы заказов
  function isFreePhone(phoneUser) {
    var xmlhttp = new XMLHttpRequest();
    let allAboutOrders;
    xmlhttp.onreadystatechange = function() {
      if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
        //json
        allAboutOrders = JSON.parse(xmlhttp.responseText);
        for (i = 0; i < allAboutOrders.length; i++) {
          if (phoneUser == allAboutOrders[i].phoneUser) {
            return false;
          }
        }
        return true;
      }
    };
    xmlhttp.open("GET", "http://localhost:8080/get/orders", true);
    xmlhttp.send();
  }
</script>
